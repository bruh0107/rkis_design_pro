{% extends 'basic.html' %}

<title>{% block title %}Личный профиль{% endblock %}</title>

{% block content %}
<div class="container">
    <h2>Добро пожаловать,
        {% if user.gender == 'M' %}
            Мистер
        {% elif user.gender == 'F' %}
            Мисс
        {% endif %}
        {{ user.first_name }}</h2>

    <p>Имя: {{ user.first_name }}</p>
    <p>Фамилия: {{ user.last_name }}</p>
    <p>Адрес электронной почты: {{ user.email }}</p>
    <h2>Мои заявки</h2>

    <form method="get" class="mb-4">
        <label for="status" class="form-label">Фильльтрация по статусу</label>
        <select class="form-select" name="status" id="status">
            <option value="" {% if status_filter == '' %}selected{% endif %}>Все</option>
            <option value="n" {% if status_filter == "N" %}selected{% endif %}>Новая</option>
            <option value="a" {% if status_filter == 'P' %}selected{% endif %}>Принято в работу</option>
            <option value="s" {% if status_filter == 'M' %}selected{% endif %}>Выполнено</option>
        </select>
    </form>

    <div>
        {% for application in applications %}
            <div class="py-3">
                <div class="d-flex align-items-center gap-2">
                    <img style="height: 150px; max-width: 150px; object-fit: cover;" src="{{ application.image.url }}" alt="Фото проекта">
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between">
                            <p class="d-flex align-items-center gap-1">{{ application.title }} {% if application.status == "N" %}
                                    <span class="text-light bg-warning px-2 py-1 rounded-2">Новая</span>
                                {% elif application.status == "P" %}
                                    <span class="text-info">Принято в работу</span>
                                {% elif application.status == "D" %}
                                    <span class="text-success">Выполнено</span>
                                {% endif %}</p>
                            <span>Категория: {{ application.category }}</span>
                        </div>
                        <div class="d-flex justify-content-end">

                            <p>Дата создания: {{ application.date|date:"d.m.Y H:i" }}</p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="width: 500px; height: 50px; text-overflow: ellipsis; overflow: hidden;">{{ application.description }}</p>
                            <form action="{% url 'application-delete' application.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-success">Удалить заявку</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div>
                <p>У вас нет заявок</p>
            </div>
        {% endfor %}
    </div>
</div>


{% endblock %}